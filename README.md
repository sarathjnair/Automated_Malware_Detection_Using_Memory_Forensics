# Automated Malware Detection Using Memory Forensics

## Overview
Memory forensics is a widely used method that provides insights into the real-time activities such as processes running, network activites, DLLs loaded, etc. Using memory forensics can be effective in malware detection due to recent advancements in malware that donâ€™t leave a trace on the disks but reside in the memory. A manual analysis of the RAM dump is time-consuming and leads to delayed responses. An automated mechanism to generate a memory dump and analyze it for any malicious activity could streamline the process by sifting through different artifacts provided by the memory dump. This also helps a forensic investigator who may not be an expert malware analyst get a better understanding of the suspicious activities that are running in a system.

## Get Started
### Memory Acquisition
In this work, the malware execution environment is a Windows 10 virtual machine, set up using Oracle VirtualBox. The memory dump is obtained using a built-in utility of Oracle VirtualBox "**VBoxManage.exe**". The utility will be available within the VirtualBox installation folder. The following commands can be run on cmd to acquire memory image: -

To list the avaiable VMs and their corresponding VM IDs:
```bash
VBoxManage.exe list vms
```
To dump the memory using the particular VM ID:
```bash
VBoxManage.exe debugvm <VM ID> dumpcore --filename <memory dump name>

#Example
VBoxManage.exe debugvm 4405509f-a9c8-4918-ba82-3d424920338d dumpcore --filename memory_dump.raw
```

### Volatility3 Installation
Volatility is an open-source Python based advanced memory forensics framework that facilitates analysing and extracting digital artifacts from memory images. It is available for Windows, Mac and Linux platforms and supports analysis for 32bit and 64bit OS. Python3 is necessary for volatility3.

```bash
sudo apt install python3
sudo apt install python3-pip
```

```bash
git clone https://github.com/volatilityfoundation/volatility3.git

cd volatility3/

#Help option to check if volatility python file is available
python3 vol.py -h
```
To enable the full range of Volatility3 functionality:

```bash
pip3 install -r requirements.txt
```
### Prerequisites

The files "**virustotal\_api\_key.txt**", "**volatility\_path.txt**"  and "**default\_processes.txt**" are required for the python script execution.

The "virustotal\_api\_key.txt" contains the API-KEY for the VirusTotal submission. For generating an API Key, Sign Up VirusTotal website: https://www.virustotal.com/gui/home/upload and generate an API Key. The user specific API-Key should be added within the file before executing the python file.

The "volatility\_path.txt" file contains the absolute path to the "**vol.py**" python file which will be available after the installation of Volatility3. The path has to be changed with the user's volatility python file path.

The "default\_processes.txt" lists some process names obtained from the psscan plugin output of a clean or non-malicious memory image analysis, which is used for filtering benign processes.

### NOTE
The VirusTotal provides two API versions Public and Premium. The Public is freely accessible to every registered user. The Premium API provides advanced VirusTotal services. The Public API is limited to 500 requests per day and a rate of 4 requests per minute. This work is done using Public API version.

### Execution
To run the tool, clone or download this repository. Run the "**malware\_scanner.py**" file using python3 and specify the absolute path to the memory image as command line argument.

```bash
python3 malware_scanner.py <path to memory image>
```
An output directory will be created in the current directory on successful execution of the program. The output files include the output of the cmdline, psscan, and netscan plugins as csv files, a folder with extracted process files, and final report with execution results.

## Architectural Block Diagram
![alt text](https://github.com/AmritaCSN/Sarath-Automated_Malware_Detection_Using_Memory_Forensics/blob/main/Code_Flow.png)
